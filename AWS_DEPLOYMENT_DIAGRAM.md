# IDP Platform - AWS Deployment Architecture

## Visual Deployment Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    INTERNET                                         â”‚
â”‚                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   GitHub     â”‚  â”‚   DuckDNS    â”‚  â”‚ Let's Encryptâ”‚  â”‚    GHCR      â”‚          â”‚
â”‚  â”‚  (Repos +    â”‚  â”‚  (DNS A      â”‚  â”‚ (TLS Certs)  â”‚  â”‚ (Container   â”‚          â”‚
â”‚  â”‚   Actions)   â”‚  â”‚   Records)   â”‚  â”‚              â”‚  â”‚  Registry)   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                  â”‚                  â”‚                  â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                  â”‚                  â”‚
          â”‚                  â”‚                  â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         â”‚         AWS VPC (Default VPC)       â”‚                  â”‚                  â”‚
â”‚         â”‚                  â”‚                  â”‚                  â”‚                  â”‚
â”‚         â”‚                  â–¼                  â”‚                  â”‚                  â”‚
â”‚         â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                  â”‚                  â”‚
â”‚         â”‚      â”‚  Internet Gateway     â”‚     â”‚                  â”‚                  â”‚
â”‚         â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                  â”‚                  â”‚
â”‚         â”‚                  â”‚                  â”‚                  â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      â”‚    Public Subnet (eu-west-2a)       â”‚                  â”‚               â”‚ â”‚
â”‚  â”‚      â”‚                  â”‚                  â”‚                  â”‚               â”‚ â”‚
â”‚  â”‚      â–¼                  â–¼                  â–¼                  â–¼               â”‚ â”‚
â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“   â”‚ â”‚
â”‚  â”‚  â”ƒ EC2 Instance #1 - IDP Backend & Frontend                           â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ Type: t3.medium                                                     â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ Public IP: 13.42.36.97                                             â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ Private IP: 172.31.46.112                                          â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ OS: Amazon Linux 2023                                              â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ                                                                     â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  Docker Compose Services                                    â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚                                                              â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  FastAPI Backend â”‚         â”‚  React Frontend  â”‚         â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚         â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚         â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  Port: 8000      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤  Port: 80/443    â”‚         â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚                  â”‚         â”‚  (NGINX)         â”‚         â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  - /api/v1/*     â”‚         â”‚                  â”‚         â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  - /metrics      â”‚         â”‚  Serves:         â”‚         â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  - /docs         â”‚         â”‚  my-idp.         â”‚         â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚                  â”‚         â”‚  duckdns.org     â”‚         â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚         â”‚                                                   â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚         â–¼                                                   â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  SQLite Database â”‚                                      â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                      â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  File: idp.db    â”‚                                      â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚                  â”‚                                      â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  Tables:         â”‚                                      â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  - projects      â”‚                                      â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  - templates     â”‚                                      â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚                                                              â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  Environment Variables:                                     â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  - GITHUB_TOKEN                                             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  - GITHUB_ORG                                               â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  - ARGOCD_PASSWORD                                          â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ                                                                     â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ Security Group #1: idp-backend-sg                                 â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                             â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ Inbound Rules:                                                     â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ   â€¢ Port 22 (SSH): Your IP only                                   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ   â€¢ Port 80 (HTTP): 0.0.0.0/0                                     â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ   â€¢ Port 443 (HTTPS): 0.0.0.0/0                                   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ   â€¢ Port 8000 (Backend API): 172.31.2.204/32 (k3s EC2)           â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ                                                                     â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ Outbound Rules:                                                    â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ   â€¢ All traffic: 0.0.0.0/0                                        â”ƒ   â”‚ â”‚
â”‚  â”‚  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›   â”‚ â”‚
â”‚  â”‚                                                                            â”‚ â”‚
â”‚  â”‚                                  â”‚                                         â”‚ â”‚
â”‚  â”‚                                  â”‚ Internal VPC Traffic                   â”‚ â”‚
â”‚  â”‚                                  â”‚ (Port 8000)                             â”‚ â”‚
â”‚  â”‚                                  â–¼                                         â”‚ â”‚
â”‚  â”‚                                                                            â”‚ â”‚
â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“   â”‚ â”‚
â”‚  â”‚  â”ƒ EC2 Instance #2 - k3s Kubernetes Cluster                           â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ Type: m7i.flex.large                                               â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ Public IP: 18.130.143.156                                          â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ Private IP: 172.31.2.204                                           â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ OS: Ubuntu 22.04                                                   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ                                                                     â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  k3s Kubernetes (Lightweight K8s Distribution)              â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚                                                              â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  Namespace: argocd                                           â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  ArgoCD (GitOps Engine)                    â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  - argocd-server                           â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  - argocd-application-controller           â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  - argocd-repo-server                      â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚                                             â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  Watches GitHub repos for Helm charts      â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  Auto-syncs to Kubernetes                  â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚                                                              â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  Namespace: monitoring                                       â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  Prometheus (Metrics Collection)           â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  Port: 9090                                â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  URL: prometheus-idp.duckdns.org          â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚                                             â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  Scrape Targets:                           â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  - IDP Backend (172.31.46.112:8000)       â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  - K8s Pods (auto-discovery)               â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚                                                              â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  Grafana (Dashboards & Visualization)      â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  Port: 3000                                â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  URL: grafana-idp.duckdns.org             â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  Login: admin / <password>                 â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚                                             â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  Dashboards:                               â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  - IDP Platform Metrics                    â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚                                                              â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  Namespace: default                                          â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  Deployed User Services                    â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  - kris-aws-svc-13                         â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  - (other user-created services)           â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚                                             â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  Each service includes:                    â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  - Deployment                              â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  - Service                                 â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  - Ingress (optional)                      â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  - /metrics endpoint                       â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚                                                              â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  Namespace: ingress-nginx                                    â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  NGINX Ingress Controller                  â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  Ports: 80, 443                            â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  Handles all external traffic              â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  TLS termination                           â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚                                                              â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  Namespace: cert-manager                                     â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  cert-manager (TLS Certificate Mgmt)       â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  - cert-manager-controller                 â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  - cert-manager-webhook                    â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚                                             â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  Issues Let's Encrypt certificates         â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â”‚  Auto-renewal                              â”‚             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ                                                                     â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ Security Group #2: k3s-cluster-sg                                  â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ Inbound Rules:                                                      â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ   â€¢ Port 22 (SSH): Your IP only                                    â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ   â€¢ Port 80 (HTTP): 0.0.0.0/0                                      â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ   â€¢ Port 443 (HTTPS): 0.0.0.0/0                                    â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ   â€¢ Port 6443 (K8s API): Your IP only                              â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ                                                                      â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ Outbound Rules:                                                     â”ƒ   â”‚ â”‚
â”‚  â”‚  â”ƒ   â€¢ All traffic: 0.0.0.0/0                                         â”ƒ   â”‚ â”‚
â”‚  â”‚  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›   â”‚ â”‚
â”‚  â”‚                                                                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow: Creating a New Service

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Developer   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. Opens browser
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  React Frontend (EC2 #1)               â”‚
â”‚  https://my-idp.duckdns.org            â”‚
â”‚                                        â”‚
â”‚  - Fill form: project name, template  â”‚
â”‚  - Click "Create"                      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. POST /api/v1/projects
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FastAPI Backend (EC2 #1)              â”‚
â”‚  http://172.31.46.112:8000             â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1. Validate request (Pydantic)   â”‚ â”‚
â”‚  â”‚ 2. Create DB record              â”‚ â”‚
â”‚  â”‚ 3. Start background task         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. Background task
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Template Engine (EC2 #1)              â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Cookiecutter renders template:   â”‚ â”‚
â”‚  â”‚ - src/ (Python/Node.js code)     â”‚ â”‚
â”‚  â”‚ - Dockerfile                     â”‚ â”‚
â”‚  â”‚ - .github/workflows/ci.yml       â”‚ â”‚
â”‚  â”‚ - helm/ (K8s manifests)          â”‚ â”‚
â”‚  â”‚ - /metrics endpoint              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 4. Create GitHub repo
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GitHub API (External)                 â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1. Create repository             â”‚ â”‚
â”‚  â”‚ 2. Push generated code           â”‚ â”‚
â”‚  â”‚ 3. Trigger GitHub Actions        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 5. GitHub Actions workflow
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GitHub Actions (External)             â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1. Checkout code                 â”‚ â”‚
â”‚  â”‚ 2. Build Docker image            â”‚ â”‚
â”‚  â”‚ 3. Run tests                     â”‚ â”‚
â”‚  â”‚ 4. Push to GHCR                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 6. Image ready
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GHCR (External)                       â”‚
â”‚  ghcr.io/org/service-name:latest       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 7. Create ArgoCD Application
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ArgoCD API (EC2 #2 - k3s)             â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Backend creates Application CRD  â”‚ â”‚
â”‚  â”‚ Source: GitHub repo/helm/        â”‚ â”‚
â”‚  â”‚ Destination: k3s cluster         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 8. ArgoCD syncs
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ArgoCD Controller (EC2 #2 - k3s)      â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1. Fetch Helm chart from GitHub  â”‚ â”‚
â”‚  â”‚ 2. Render Kubernetes manifests   â”‚ â”‚
â”‚  â”‚ 3. Apply to cluster              â”‚ â”‚
â”‚  â”‚ 4. Monitor health                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 9. Deploy to K8s
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Kubernetes (EC2 #2 - k3s)             â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Resources created:               â”‚ â”‚
â”‚  â”‚ - Deployment                     â”‚ â”‚
â”‚  â”‚ - Service                        â”‚ â”‚
â”‚  â”‚ - (Optional) Ingress             â”‚ â”‚
â”‚  â”‚                                  â”‚ â”‚
â”‚  â”‚ Pod annotations added:           â”‚ â”‚
â”‚  â”‚   prometheus.io/scrape: "true"   â”‚ â”‚
â”‚  â”‚   prometheus.io/port: "8080"     â”‚ â”‚
â”‚  â”‚   prometheus.io/path: "/metrics" â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 10. Auto-discovery
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Prometheus (EC2 #2 - k3s)             â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1. K8s service discovery         â”‚ â”‚
â”‚  â”‚ 2. Detects new pod               â”‚ â”‚
â”‚  â”‚ 3. Starts scraping /metrics      â”‚ â”‚
â”‚  â”‚ 4. Stores time-series data       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 11. Visualization
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Grafana (EC2 #2 - k3s)                â”‚
â”‚  https://grafana-idp.duckdns.org       â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Dashboards show:                 â”‚ â”‚
â”‚  â”‚ - HTTP request rate              â”‚ â”‚
â”‚  â”‚ - Response latency               â”‚ â”‚
â”‚  â”‚ - Error rate                     â”‚ â”‚
â”‚  â”‚ - Resource usage                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
  Service is LIVE! ğŸš€
```

---

## Network Security: Security Group Configuration

### Security Group #1: idp-backend-sg (EC2 #1)

**Purpose:** Protect IDP backend and frontend

| Type | Protocol | Port | Source | Purpose |
|------|----------|------|--------|---------|
| SSH | TCP | 22 | Your IP | Remote administration |
| HTTP | TCP | 80 | 0.0.0.0/0 | Web traffic (redirects to HTTPS) |
| HTTPS | TCP | 443 | 0.0.0.0/0 | Secure web traffic for IDP portal |
| Custom | TCP | 8000 | 172.31.2.204/32 | Backend API for Prometheus scraping from k3s cluster |
| All Traffic | All | All | 0.0.0.0/0 | Outbound (GitHub API, Docker Hub, etc.) |

### Security Group #2: k3s-cluster-sg (EC2 #2)

**Purpose:** Protect Kubernetes cluster

| Type | Protocol | Port | Source | Purpose |
|------|----------|------|--------|---------|
| SSH | TCP | 22 | Your IP | Remote administration |
| HTTP | TCP | 80 | 0.0.0.0/0 | NGINX Ingress for Prometheus/Grafana |
| HTTPS | TCP | 443 | 0.0.0.0/0 | Secure NGINX Ingress |
| Custom | TCP | 6443 | Your IP | Kubernetes API server (kubectl access) |
| All Traffic | All | All | 0.0.0.0/0 | Outbound (GHCR, GitHub, Let's Encrypt, etc.) |

**Key Security Design:**
- Backend API (port 8000) only accessible from k3s cluster private IP
- SSH access restricted to your IP only
- Kubernetes API (6443) restricted to your IP only
- Public services (80/443) open for web traffic
- All outbound traffic allowed for pulling images and calling external APIs

---

## DNS Configuration (DuckDNS)

| Domain | Type | Points To | Service |
|--------|------|-----------|---------|
| my-idp.duckdns.org | A | 13.42.36.97 | IDP Web Portal (Frontend + Backend) |
| prometheus-idp.duckdns.org | A | 18.130.143.156 | Prometheus UI |
| grafana-idp.duckdns.org | A | 18.130.143.156 | Grafana Dashboards |

**Design Decision: Separate Domains**
- Initially tried path-based routing (`/prometheus`, `/grafana`)
- Switched to subdomain routing for:
  - Cleaner URLs
  - Simpler TLS certificate management
  - Better application compatibility
  - No path rewriting complexity

---

## Storage Architecture

### EC2 Instance #1 (Backend)
- **OS Disk:** 30 GB gp3 EBS volume
- **Database:** SQLite file at `/home/ec2-user/idp/backend/idp.db`
- **Templates:** `/home/ec2-user/idp/backend/app/templates/`
- **Temp Files:** `/tmp/` for Cookiecutter rendering

### EC2 Instance #2 (k3s Cluster)
- **OS Disk:** 50 GB gp3 EBS volume
- **k3s Data:** `/var/lib/rancher/k3s/`
- **Container Images:** Pulled from GHCR
- **Prometheus Data:** emptyDir volume (ephemeral, 7-day retention)
- **Grafana Data:** emptyDir volume (ephemeral)

**Future Enhancement:** Add EBS-backed PersistentVolumes for metric retention

---

## Monitoring & Observability Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Metrics Sources                                            â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                     â”‚
    â”‚                     â”‚
    â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IDP Backend     â”‚   â”‚ Deployed User Services (K8s Pods)â”‚
â”‚ (EC2 #1)        â”‚   â”‚ (EC2 #2 - k3s)                   â”‚
â”‚                 â”‚   â”‚                                  â”‚
â”‚ FastAPI app     â”‚   â”‚ - kris-aws-svc-13                â”‚
â”‚ exposes:        â”‚   â”‚ - other services                 â”‚
â”‚ /metrics        â”‚   â”‚                                  â”‚
â”‚                 â”‚   â”‚ Each exposes:                    â”‚
â”‚ Metrics:        â”‚   â”‚ /metrics                         â”‚
â”‚ - HTTP requests â”‚   â”‚                                  â”‚
â”‚ - Latency       â”‚   â”‚ Metrics:                         â”‚
â”‚ - Project CRUD  â”‚   â”‚ - HTTP requests                  â”‚
â”‚ - External API  â”‚   â”‚ - Latency                        â”‚
â”‚   calls         â”‚   â”‚ - Error rate                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚
         â”‚ Scraped every 15s     â”‚ Auto-discovered
         â”‚ (static config)       â”‚ (annotations)
         â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Prometheus           â”‚
         â”‚  (EC2 #2 - k3s)       â”‚
         â”‚                       â”‚
         â”‚  - Stores metrics     â”‚
         â”‚  - 7-day retention    â”‚
         â”‚  - PromQL queries     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ Prometheus datasource
                     â”‚
                     â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Grafana              â”‚
         â”‚  (EC2 #2 - k3s)       â”‚
         â”‚                       â”‚
         â”‚  Dashboards:          â”‚
         â”‚  - IDP Platform       â”‚
         â”‚  - Service Metrics    â”‚
         â”‚                       â”‚
         â”‚  Accessible via:      â”‚
         â”‚  grafana-idp.         â”‚
         â”‚  duckdns.org          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Operations Team      â”‚
         â”‚  / Developers         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Versions & Technologies

### EC2 Instance #1 (IDP Backend)
- **OS:** Amazon Linux 2023
- **Docker:** 24.x
- **Docker Compose:** 2.x
- **Python:** 3.11
- **FastAPI:** 0.104.1
- **SQLAlchemy:** 2.0.x
- **Node.js:** 18.x (for frontend build)
- **React:** 18.x
- **Nginx:** (in frontend container)

### EC2 Instance #2 (k3s Cluster)
- **OS:** Ubuntu 22.04 LTS
- **k3s:** v1.28.x (Lightweight Kubernetes)
- **ArgoCD:** v2.9.x
- **Prometheus:** v2.48.0
- **Grafana:** 10.2.3
- **cert-manager:** v1.13.x
- **NGINX Ingress:** v1.9.x

### External Services
- **GitHub:** Cloud (SaaS)
- **GitHub Actions:** Cloud (SaaS)
- **GHCR:** Cloud (SaaS)
- **DuckDNS:** Cloud (SaaS)
- **Let's Encrypt:** Cloud (SaaS)

---

## Cost Breakdown (Approximate)

### AWS Resources
| Resource | Type | Monthly Cost (est.) |
|----------|------|---------------------|
| EC2 #1 (Backend) | t3.medium | ~$30 |
| EC2 #2 (k3s) | m7i.flex.large | ~$70 |
| EBS Volume #1 | 30 GB gp3 | ~$3 |
| EBS Volume #2 | 50 GB gp3 | ~$5 |
| Data Transfer | Variable | ~$5-20 |
| **Total AWS** | | **~$113-128/month** |

### External Services (Free Tiers)
- GitHub (public repos): **Free**
- GitHub Actions (public repos): **Free**
- GHCR (public images): **Free**
- DuckDNS: **Free**
- Let's Encrypt: **Free**

**Total Monthly Cost:** ~$113-128 USD

---

## Scaling Considerations

### Current Setup (MVP)
- Single region: eu-west-2 (London)
- Single availability zone
- 2 EC2 instances
- No auto-scaling
- No load balancing
- SQLite database (single file)

### Production Scaling Path

**Phase 1: High Availability**
- Multi-AZ deployment
- RDS PostgreSQL instead of SQLite
- Application Load Balancer
- Auto Scaling Groups for EC2
- EBS snapshots for backups

**Phase 2: Multi-Cluster**
- Separate k8s clusters for dev/staging/prod
- ArgoCD multi-cluster support
- Environment promotion workflows

**Phase 3: Multi-Region**
- Regional k8s clusters
- Global database (Aurora Global Database)
- Route53 for geo-routing
- S3 for template storage

---

## Disaster Recovery

### Backup Strategy

**Current (MVP):**
- Manual EBS snapshots
- GitHub repos as code backup
- ArgoCD syncs from Git (GitOps)

**Recommended (Production):**
- Automated daily EBS snapshots (7-day retention)
- RDS automated backups (35-day retention)
- S3 versioning for configuration files
- Cross-region replication for critical data

### Recovery Procedures

**EC2 Instance Failure:**
1. Launch new EC2 from latest snapshot
2. Update DuckDNS A records
3. Restore Docker Compose services
4. Verify health checks

**k3s Cluster Failure:**
1. Launch new EC2 instance
2. Install k3s
3. ArgoCD re-syncs all applications from Git
4. Services automatically restored

**Database Corruption:**
1. Stop backend service
2. Restore SQLite from latest snapshot
3. Restart services
4. Verify data integrity

**RTO (Recovery Time Objective):** ~30 minutes
**RPO (Recovery Point Objective):** ~24 hours (daily snapshots)

---

## Summary

### Architecture Highlights

âœ… **Two-Tier Architecture**
- EC2 #1: IDP control plane (backend + frontend)
- EC2 #2: Kubernetes runtime (workloads + monitoring)

âœ… **GitOps-First Design**
- Git as single source of truth
- ArgoCD for declarative deployments
- Automatic drift detection and remediation

âœ… **Built-in Observability**
- Prometheus auto-discovery via annotations
- Grafana dashboards for all services
- Zero-config monitoring for developers

âœ… **Security by Design**
- Security groups with least privilege
- TLS everywhere (Let's Encrypt)
- No public database access
- SSH restricted to admin IP

âœ… **Cost-Optimized**
- Lightweight k3s instead of managed EKS (~$70/month savings)
- SQLite instead of RDS (MVP only)
- Free external services (GitHub, DuckDNS, Let's Encrypt)
- Total: ~$113-128/month

âœ… **Developer Experience**
- One-click service creation
- Automatic CI/CD pipeline
- Zero-downtime deployments
- Production-ready in 3 minutes

---

## Next Steps for Production

1. **High Availability**
   - Migrate to RDS PostgreSQL
   - Add Application Load Balancer
   - Multi-AZ deployment

2. **Monitoring Enhancements**
   - Add PersistentVolumes for Prometheus
   - Configure alerting rules
   - Add log aggregation (Loki)

3. **Security Hardening**
   - Add OAuth2 authentication (Keycloak/Auth0)
   - Enable Pod Security Policies
   - Implement network policies

4. **CI/CD Improvements**
   - Add staging environment
   - Blue-green deployments
   - Automated rollback on failures

5. **Multi-Tenancy**
   - Per-team namespaces
   - Resource quotas
   - RBAC policies
